<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard</title>

  <!-- Disable Devtool -->
  <script src="/js/anti-devtools.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { background-color: #e0e0e0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px;}
    .user-info { text-align: center; margin-bottom: 20px; font-size: 16px;}
    .user-info span { font-weight: bold; }
    .role-superadmin { color: red; font-weight: bold; }
    .role-admin { color: red; font-weight: bold; }
    .role-giaovien { color: green; font-weight: bold; }
    .role-user { color: blue; font-weight: bold; }
    .logout-btn {
      margin: 30px auto 0 auto;
      padding: 10px 30px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      display: block;   /* đảm bảo có thể căn giữa */
    }
    .logout-btn:hover {
      background: #b02a37;
    }
    .flower-grid { display: grid; grid-template-columns: repeat(2, 130px); grid-template-rows: repeat(2, 130px); gap: 8px; justify-content: center; align-items: center; margin: 20px auto 0 auto;}
    .flower-item { width: 130px; height: 130px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; cursor: pointer; transition: transform 0.2s;}
    .flower-item:hover { transform: scale(1.08);}
    .flower-top-left { background-color: #4caf50; color: #fff; border-top-left-radius: 75%;}
    .flower-top-right { background-color: #ffeb3b; color: #fff; border-top-right-radius: 75%;}
    .flower-bottom-left { background-color: #f44336; color: #fff; border-bottom-left-radius: 75%;}
    .flower-bottom-right { background-color: #9c27b0; color: #fff; border-bottom-right-radius: 75%;}
    .extra-btn { display: block; margin: 20px auto 0 auto; padding: 12px 40px; background-color: #0d47a1; color: #fff; font-weight: bold; border-radius: 30px; text-align: center; cursor: pointer; transition: transform 0.2s;}
    .extra-btn:hover { transform: scale(1.08);}
    .parent-grid { display: grid; grid-template-columns: repeat(3, 110px); grid-template-rows: auto; gap: 8px; justify-content: center; margin-top: 30px;}
    .parent-item { display: flex; align-items: center; justify-content: center; font-weight: bold; color: #fff; border-radius: 6px; font-size: 14px; cursor: pointer; transition: transform 0.2s;}
    .parent-item:hover { transform: scale(1.05);}
    .p1 { background-color: #3e2c92; grid-column: span 3; height: 90px; font-size: 16px;}
    .p2 { background-color: #6a1b9a; height: 90px;}
    .p3 { background-color: #5e35b1; height: 90px;}
    .p4 { background-color: #c2185b; height: 90px;}
    .p5 { background-color: #f57c00; grid-column: span 2; height: 90px;}
    .p6 { background-color: #009688; height: 90px;}
  </style>
</head>
<body>
  <div class="user-info">
    Tên: <span id="user-name"></span><br/>
    Quyền: <span id="user-role"></span><br/>
    Trường: <span id="user-school"></span><br/>
    Tỉnh: <span id="user-province"></span>
  </div>
  <h3 class="fw-bold mb-4">DANH MỤC CÔNG VIỆC</h3>
  <div id="menu-container"></div>


  <button class="logout-btn" onclick="logout()">Đăng xuất</button>


  <!-- Loading Spinner -->
  <div id="loadingSpinner" style="
    display:none;
    position:fixed;
    top:0; left:0; width:100vw; height:100vh; z-index:9999;
    background:rgba(255,255,255,0.5); 
    align-items:center; justify-content:center;">
    <div class="spinner-border text-primary" role="status" style="width:3rem;height:3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>




  <!-- Footer -->
  <footer style="text-align:center; margin-top:20px; padding:10px; font-size:14px; color:#555;">
    Copyright &copy; ABT Medu 2025
  </footer>






  <!-- Bootstrap JS & các thư viện khác -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* =============================
    *  BIẾN TOÀN CỤC & TIỆN ÍCH
    * ============================= */
    let user = JSON.parse(localStorage.getItem("user") || "{}");

    /** Hiện/ẩn loading spinner */
    function showLoading() {
      document.getElementById('loadingSpinner').style.display = 'flex';
    }
    function hideLoading() {
      document.getElementById('loadingSpinner').style.display = 'none';
    }

    /* =============================
    *  XỬ LÝ HIỂN THỊ THÔNG TIN NGƯỜI DÙNG
    * ============================= */
    if (!user.sdt) {
      window.location.href = "../index.html";
    } else {
      document.getElementById("user-name").innerText = user.ho_ten || "";
      document.getElementById("user-school").innerText = user.ten_truong || "";
      document.getElementById("user-province").innerText = user.tinh || "";
      // Xử lý text và class quyền
      let roleText = "", roleClass = "";
      switch (user.phan_quyen) {
        case "super_admin": roleText = "Admin tối cao"; roleClass = "role-superadmin"; break;
        case "admin": roleText = "Admin"; roleClass = "role-admin"; break;
        case "giao_vien": roleText = "Giáo viên"; roleClass = "role-giaovien"; break;
        default: roleText = "Phụ huynh"; roleClass = "role-user";
      }
      document.getElementById("user-role").innerHTML = `<span class='${roleClass}'>${roleText}</span>`;
    }

    /* =============================
    *  HIỂN THỊ MENU DASHBOARD THEO PHÂN QUYỀN
    * ============================= */
    const container = document.getElementById("menu-container");
    container.innerHTML = "";
    if (user.phan_quyen === "super_admin") {
      container.innerHTML = `
        <div class="flower-grid">
          <div class="flower-item flower-top-left">YTTH</div>
          <div class="flower-item flower-top-right">BHYT</div>
          <div class="flower-item flower-bottom-left">BHTN</div>
          <div class="flower-item flower-bottom-right">KHÁC</div>
        </div>
        <div class="extra-btn">Quản trị Superadmin</div>`;
    } else if (user.phan_quyen === "admin") {
      container.innerHTML = `
        <div class="flower-grid">
          <div class="flower-item flower-top-left">YTTH</div>
          <div class="flower-item flower-top-right" onclick="goToBHYT()">BHYT</div>
          <div class="flower-item flower-bottom-left">BHTN</div>
          <div class="flower-item flower-bottom-right">KHÁC</div>
        </div>
        <div class="extra-btn">Quản trị Admin</div>`;
    } else if (user.phan_quyen === "giao_vien") {
      container.innerHTML = `
        <div class="flower-grid">
          <div class="flower-item flower-top-left" onclick="goToDSHocsinh()">DS Học sinh</div>
          <div class="flower-item flower-top-right" onclick="goToBHYT_giaovien()">BHYT</div>
          <div class="flower-item flower-bottom-left" onclick="goToBHTN_giaovien()">BHTN</div>
          <div class="flower-item flower-bottom-right">KHÁC</div>
        </div>`;
    } else {
      container.innerHTML = `
        <div class="parent-grid">
          <div class="parent-item p1">SỨC KHỎE HỌC SINH</div>
          <div class="parent-item p2">PHÒNG BỆNH</div>
          <div class="parent-item p3">BHYT</div>
          <div class="parent-item p4">BHTN</div>
          <div class="parent-item p5">TIÊM NGỪA</div>
          <div class="parent-item p6">KHÁM SỨC KHỎE</div>
        </div>`;
    }

    /* =============================
    *  CÁC HÀM CHUYỂN TRANG & ĐĂNG XUẤT
    * ============================= */
    /** Đăng xuất: xóa user, về index */
    function logout() {
      localStorage.removeItem("user");
      window.location.href = "../index.html";
    }

    /** Chuyển đến danh sách học sinh */
    function goToDSHocsinh() {
      showLoading();
      window.location.href = "ds_hocsinh.html";
    }

    /** Chuyển đến trang BHYT (dành cho admin) */
    function goToBHYT() {
      showLoading();
      window.location.href = "bhyt.html";
    }

    /** Chuyển đến BHYT giáo viên */
    function goToBHYT_giaovien() {
      showLoading();
      window.location.href = "bhyt_giaovien.html";
    }

    /** Chuyển đến BHYT giáo viên */
    function goToBHTN_giaovien() {
      showLoading();
      window.location.href = "bhtn_giaovien.html";
    }

    /* =============================
    *  SỰ KIỆN KHỞI TẠO
    * ============================= */
    window.addEventListener('load', function() {
      hideLoading();
      console.log("Trang dashboard đã tải xong!");
      // Có thể thêm các khởi tạo khác ở đây
    });
  </script>
</body>
</html>
